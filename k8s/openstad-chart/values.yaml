
# TODO

# Tests to see whether everything works as it should
# Check whether the given values can be changed without breaking anything
# Add PVC (Persistent Volume Claims)
# Create MySQL/MongoDB databases if there is none already
# Add initContainers for databases

# Define anchors

define:
  namespace: &namespace openstad
  frontendService:
    name: &fesName "frontend-service"
    path: &fesPath /
    containerPort: &fesContainerPort 4444
  authService:
    name: &asName "auth-service"
    path: &asPath /oauth
    containerPort: &asContainerPort 4000
  host:
    host-url: &host-url www.openstad.softwaredepartment.net
    host-http: &host-http http://www.openstad.softwaredepartment.net
    host-https: &host-https https://www.openstad.softwaredepartment.net

# Dependencies
global:
  mongodb: 
    enabled: false
  mysql: 
    enabled: false
  cert-manager: 
    enabled: false

# Secrets

secrets:
  namespace: *namespace

  database: # SQL database
    image:
      secretName: openstad-image-db # Originally: openstad-image-db
      dbName: image
    
    api:
      secretName: openstad-api-db # Originally: openstad-api-db
      dbName: api

    auth:
      secretName: openstad-auth-db # Originally: openstad-auth-db
      dbName: auth

      credentials:
        secretName: openstad-auth-credentials # Originally: openstad-auth-credentials

        clientId: clientID
        clientSecret: clientSecret
        fixedUserId: 2
        fixedToken: fixedToken

    secretName: openstad-db-credentials # Originally: openstad-db-credentials
    dbName: mysql
    type: mysql
    hostname: openstad-mysql.openstad.svc.cluster.local
    hostport: 3306
    password: LorrmEcZ5aZlYqmR5hAHpV2QhDCImQfW
    username: openstad

  mongodb: # Mongo Database
    secretName: openstad-mongo-credentials # Originally: openstad-mongo-credentials
    hostname: openstad-mongodb.openstad.svc.cluster.local
    hostport: 27017
    database: openstad_mongodb

  cookies:
    secretName: openstad-cookies # Originally: openstad-cookies
    cookieSecret: IloveCookies
    jwtSecret: SecretToken

  hosts:
    secretName: openstad-hosts # Originally: openstad-hosts-test
    api: api.openstad.svc.cluster.local
    auth: auth.openstad.svc.cluster.local
    frontend: frontend.openstad.svc.cluster.local
    image: image.openstad.svc.cluster.local

  mail:
    api:
      secretName: openstad-api-mail # Originally: openstad-api-mail
      host: mail.example.com
      port: 587
      user: user@example.com
      password: pwd123

    auth:
      secretName: openstad-auth-mail # Originally: openstad-auth-mail
      emailAssetsUrl: assets.example.com
      host: mail.example.com
      password: pwd123
      port: 587
      user: mail@example.com
  

# Generic

host:
  www: *host-url
  http: *host-http
  https: *host-https

# Ingress

ingress:
  namespace: *namespace
  name: "openstad-ingress" # Originally: openstad-ingress 

  frontendService:
    name: *fesName
    path: *fesPath
    containerPort: *fesContainerPort

  authService:
    name: *asName
    path: *asPath
    containerPort: *asContainerPort

# Frontend

frontend:
    replicas: 1 # Originally: 1
    namespace: *namespace # Originally: openstad

    deploymentContainer:
        name: frontend-container # Originally: frontend
        image: openstad/frontend:debug # Originally: openstad/frontend:debug
        port: *fesContainerPort # Originally: 4444

    host:
        path: *fesPath

    deployment:
        name: "frontend-deploy" # Originally: frontend

    service:
        name: frontend-service # Originally: frontend-service
        httpPort: *fesContainerPort
        managementPort: 9090
    
    probe:
      liveness:
        initialDelaySeconds: 30
        periodSeconds: 60

# Adminer

adminer:
  replicas: 1 # Originally: 1

  namespace: *namespace
  service:
    name: adminer-service
  deployment:
    name: adminer-deploy
  
  label: adminer-web

  deploymentContainer:
    name: auth
    image: adminer
    port: 8080

  probe:
    liveness:
      initialDelaySeconds: 30
      periodSeconds: 60

# Auth

auth:
  replicas: 1 # Originally: 1

  namespace: *namespace
  service:
    name: auth-service
  deployment:
    name: auth-deploy
  
  label: auth-container

  host:
    path: *asPath

  deploymentContainer:
    name: auth-container
    image: openstad/auth:test
    port: 4000
  
  probe:
    liveness:
      initialDelaySeconds: 30
      periodSeconds: 60

# API

api:
  replicas: 1 # Originally: 1
  
  namespace: *namespace
  service:
    name: api-service
  deployment:
    name: api-deploy
  
  label: openstad-api

  deploymentContainer:
    name: api-container
    image: openstad/api:test
    port: 8111

  probe:
    liveness:
      initialDelaySeconds: 30
      periodSeconds: 60

# Image

image:
  replicas: 1 # Originally: 1
  
  namespace: *namespace
  service:
    name: image-service
  deployment:
    name: image-deploy
  
  label: image-container

  host:
    path: /

  deploymentContainer:
    name: image
    image: openstad/image:test
    port: 4100

  probe:
    liveness:
      initialDelaySeconds: 30
      periodSeconds: 60

# TLS

tls:
    host: *host-url
    secretName: openstad-tls